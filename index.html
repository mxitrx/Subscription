<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Money Manager (Offline)</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Orange Theme */
            --primary: #f97316;       
            --primary-light: #fdba74; 
            --primary-dark: #c2410c;  
            
            --bg-color: #fff7ed;      
            --card-bg: #ffffff;
            --text-main: #431407;     
            --text-sec: #9a3412;      
            
            --success: #22c55e;
            --danger: #ef4444;
            
            --shadow-sm: 0 2px 4px rgba(249, 115, 22, 0.1);
            --shadow-glow: 0 4px 20px rgba(249, 115, 22, 0.25);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Prompt', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-main);
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* --- Header --- */
        .header-section {
            background: var(--card-bg);
            padding: 20px 24px 30px;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .nav-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }
        .month-title { font-size: 20px; font-weight: 700; color: var(--text-main); }
        .nav-btn {
            background: #fff; border: 1px solid #fed7aa; 
            width: 36px; height: 36px; border-radius: 12px; 
            color: var(--primary); cursor: pointer;
            transition: 0.2s;
        }
        .nav-btn:active { background: var(--primary); color: white; }

        .summary-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 24px; padding: 24px; color: white;
            box-shadow: var(--shadow-glow);
            position: relative; overflow: hidden;
        }
        .summary-card::after {
            content: ''; position: absolute; bottom: -30px; right: -20px;
            width: 120px; height: 120px; background: rgba(255,255,255,0.15);
            border-radius: 50%;
        }

        .summary-label { font-size: 13px; opacity: 0.9; margin-bottom: 4px; }
        .summary-value { font-size: 38px; font-weight: 700; line-height: 1; margin-bottom: 15px; }

        .progress-bar-bg {
            width: 100%; height: 6px; background: rgba(0,0,0,0.2);
            border-radius: 10px; margin-top: 10px; overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%; background: #fff; width: 0%; transition: width 0.5s ease;
        }
        .progress-text {
            display: flex; justify-content: space-between; font-size: 12px; margin-top: 5px; opacity: 0.9;
        }

        /* --- List --- */
        .content-area {
            flex: 1; overflow-y: auto; padding: 20px 24px 100px;
        }

        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            margin: 20px 0 10px;
        }
        .section-title { font-size: 14px; font-weight: 600; color: var(--text-sec); text-transform: uppercase; }
        .badge { background: #fed7aa; color: var(--primary-dark); padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; }

        .item-card {
            background: white; border-radius: 18px; padding: 16px;
            margin-bottom: 12px; display: flex; align-items: center;
            box-shadow: var(--shadow-sm); transition: 0.2s;
            position: relative;
        }
        
        .item-card.paid { opacity: 0.6; background: #fffaf0; box-shadow: none; border: 1px solid #fce7f3; }
        .item-card.paid .item-name { text-decoration: line-through; color: var(--text-sec); }

        .icon-box {
            width: 46px; height: 46px; border-radius: 14px;
            background: #fff7ed; color: var(--primary);
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; margin-right: 15px; flex-shrink: 0;
            border: 1px solid #ffedd5;
        }

        .info { flex: 1; }
        .item-name { font-size: 16px; font-weight: 600; color: var(--text-main); margin-bottom: 2px; }
        .item-price { font-size: 14px; color: var(--text-sec); font-weight: 500; }

        /* Edit Button */
        .btn-edit-mini {
            background: none; border: none; color: #cbd5e1;
            padding: 8px; margin-right: 5px; cursor: pointer; font-size: 16px;
        }
        .btn-edit-mini:hover { color: var(--primary); }

        /* Checkbox */
        .checkbox-custom {
            width: 26px; height: 26px; border: 2px solid #fed7aa;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: transparent; cursor: pointer; transition: 0.2s;
        }
        .item-card.paid .checkbox-custom {
            background: var(--success); border-color: var(--success); color: white;
        }

        /* --- FAB --- */
        .fab {
            position: fixed; bottom: 30px; right: 24px;
            width: 60px; height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; border-radius: 50%; border: none;
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4);
            font-size: 24px; cursor: pointer; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        .fab:active { transform: scale(0.9) rotate(90deg); }

        /* --- Modal --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(67, 20, 7, 0.6); z-index: 200;
            display: flex; align-items: flex-end;
            visibility: hidden; opacity: 0; transition: 0.3s;
            backdrop-filter: blur(3px);
        }
        .modal.active { visibility: visible; opacity: 1; }
        
        .modal-content {
            background: white; width: 100%; 
            border-top-left-radius: 30px; border-top-right-radius: 30px;
            padding: 30px 24px 40px; 
            transform: translateY(100%); transition: 0.3s;
        }
        .modal.active .modal-content { transform: translateY(0); }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .modal-title { font-size: 20px; font-weight: 700; color: var(--text-main); }
        .close-btn { background: #f1f5f9; border: none; width: 32px; height: 32px; border-radius: 50%; color: var(--text-sec); cursor: pointer; }

        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text-sec); margin-bottom: 8px; }
        .input-field {
            width: 100%; padding: 14px 16px; border-radius: 14px;
            border: 1px solid #fed7aa; font-size: 16px; outline: none;
            background: #fffaf0; transition: 0.2s;
        }
        .input-field:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.15); }
        
        .btn-submit {
            width: 100%; padding: 16px; background: var(--primary);
            color: white; border: none; border-radius: 16px;
            font-size: 16px; font-weight: 600; margin-top: 10px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
        }
        
        .btn-delete {
            width: 100%; padding: 14px; background: transparent;
            color: var(--danger); border: 1px solid var(--danger); border-radius: 16px;
            font-size: 16px; font-weight: 600; margin-top: 10px; cursor: pointer;
            display: none; /* Show only on edit */
        }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header-section">
            <div class="nav-bar">
                <button class="nav-btn" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                <div class="month-title" id="monthDisplay">...</div>
                <button class="nav-btn" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            
            <div class="summary-card">
                <div class="summary-label">ยอดที่ต้องจ่าย</div>
                <div class="summary-value" id="totalPending">฿0</div>
                
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressBar"></div>
                </div>
                <div class="progress-text">
                    <span id="progressText">จ่ายแล้ว 0%</span>
                    <span id="totalPaidText">0/0</span>
                </div>
            </div>
        </div>

        <div class="content-area">
            <div class="section-header">
                <span class="section-title">รอจ่าย (To Pay)</span>
                <span class="badge" id="countPending">0</span>
            </div>
            <div id="listPending"></div>

            <div class="section-header" style="margin-top: 30px;">
                <span class="section-title">เรียบร้อย (Completed)</span>
                <span class="badge" id="countPaid">0</span>
            </div>
            <div id="listPaid"></div>
        </div>

        <button class="fab" onclick="openModal()"><i class="fas fa-plus"></i></button>

        <div class="modal" id="modal" onclick="if(event.target === this) closeModal()">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">เพิ่มรายการ</div>
                    <button class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></button>
                </div>
                
                <input type="hidden" id="editId"> <div class="input-group">
                    <label>ชื่อรายการ</label>
                    <input type="text" class="input-field" id="nameInput" placeholder="เช่น ค่าห้อง, Netflix">
                </div>
                <div class="input-group">
                    <label>ราคา (บาท)</label>
                    <input type="number" class="input-field" id="priceInput" placeholder="0.00">
                </div>
                <div class="input-group">
                    <label>หมวดหมู่</label>
                    <select class="input-field" id="catInput">
                        <option value="General">ทั่วไป</option>
                        <option value="Entertainment">บันเทิง</option>
                        <option value="Loan">หนี้/ผ่อน</option>
                        <option value="Utility">บิล/เน็ต</option>
                    </select>
                </div>

                <button class="btn-submit" id="saveBtn" onclick="saveItem()">บันทึกรายการ</button>
                <button class="btn-delete" id="deleteBtn" onclick="deleteItem()">ลบรายการนี้</button>
            </div>
        </div>

    </div>

    <script>
        // --- STORAGE SYSTEM (Local Storage) ---
        const STORAGE_KEY = 'orange_tracker_data'; // กุญแจสำหรับไขดูข้อมูลในเครื่อง

        let items = [];
        let currentDate = new Date();
        const monthsTH = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];

        // ฟังก์ชันโหลดข้อมูลจากเครื่อง
        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                items = JSON.parse(savedData);
            } else {
                // ข้อมูลตัวอย่างสำหรับครั้งแรก
                items = [
                    { id: '1', name: 'Netflix', price: 169, category: 'Entertainment', paidHistory: {} },
                    { id: '2', name: 'ค่าห้อง', price: 4500, category: 'Loan', paidHistory: {} }
                ];
                saveToLocal(); // บันทึกข้อมูลตัวอย่างลงเครื่องทันที
            }
            render();
        }

        // ฟังก์ชันบันทึกลงเครื่อง (เรียกใช้ทุกครั้งที่มีการแก้ไข)
        function saveToLocal() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
        }

        function getMonthKey() {
            return currentDate.getFullYear() + '-' + String(currentDate.getMonth() + 1).padStart(2, '0');
        }

        function render() {
            const monthKey = getMonthKey();
            const listPending = document.getElementById('listPending');
            const listPaid = document.getElementById('listPaid');
            
            document.getElementById('monthDisplay').innerText = `${monthsTH[currentDate.getMonth()]} ${currentDate.getFullYear() + 543}`;

            listPending.innerHTML = '';
            listPaid.innerHTML = '';

            let sumPending = 0, sumPaid = 0, countPending = 0, countPaid = 0;

            if (items.length === 0) {
                listPending.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">ไม่มีรายการ</div>';
            }

            items.forEach((item) => {
                const isPaid = item.paidHistory && item.paidHistory[monthKey];
                const price = parseFloat(item.price);
                
                const cardHTML = `
                    <div class="item-card ${isPaid ? 'paid' : ''}">
                        <div class="icon-box">
                            ${getIcon(item.category)}
                        </div>
                        <div class="info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">฿${price.toLocaleString()}</div>
                        </div>
                        
                        <button class="btn-edit-mini" onclick="openEditModal('${item.id}', event)">
                            <i class="fas fa-pen"></i>
                        </button>

                        <div class="checkbox-custom" onclick="toggleStatus('${item.id}')">
                            <i class="fas fa-check" style="font-size: 14px;"></i>
                        </div>
                    </div>
                `;

                if (isPaid) {
                    listPaid.innerHTML += cardHTML;
                    sumPaid += price;
                    countPaid++;
                } else {
                    listPending.innerHTML += cardHTML;
                    sumPending += price;
                    countPending++;
                }
            });

            const total = sumPending + sumPaid;
            const percent = total === 0 ? 0 : (sumPaid / total) * 100;

            document.getElementById('totalPending').innerText = `฿${sumPending.toLocaleString()}`;
            document.getElementById('countPending').innerText = countPending;
            document.getElementById('countPaid').innerText = countPaid;
            
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressText').innerText = `จ่ายแล้ว ${Math.round(percent)}%`;
            document.getElementById('totalPaidText').innerText = `฿${sumPaid.toLocaleString()} / ฿${total.toLocaleString()}`;
        }

        function toggleStatus(id) {
            const item = items.find(i => i.id == id);
            const monthKey = getMonthKey();
            if(!item.paidHistory) item.paidHistory = {};

            if(item.paidHistory[monthKey]) {
                delete item.paidHistory[monthKey];
            } else {
                item.paidHistory[monthKey] = true;
            }
            saveToLocal(); // บันทึกทันที
            render();
        }

        // --- EDIT / ADD Logic ---
        function openEditModal(id, event) {
            if(event) event.stopPropagation();
            
            const item = items.find(i => i.id == id);
            document.getElementById('editId').value = item.id;
            document.getElementById('nameInput').value = item.name;
            document.getElementById('priceInput').value = item.price;
            document.getElementById('catInput').value = item.category;

            document.getElementById('modalTitle').innerText = "แก้ไขรายการ";
            document.getElementById('saveBtn').innerText = "บันทึกการแก้ไข";
            document.getElementById('deleteBtn').style.display = "block";

            openModal(true);
        }

        function saveItem() {
            const id = document.getElementById('editId').value;
            const name = document.getElementById('nameInput').value;
            const price = document.getElementById('priceInput').value;
            const cat = document.getElementById('catInput').value;

            if(!name || !price) return alert("กรุณากรอกข้อมูล");

            if(id) {
                // แก้ไข
                const index = items.findIndex(i => i.id == id);
                if(index !== -1) {
                    items[index].name = name;
                    items[index].price = parseFloat(price);
                    items[index].category = cat;
                }
            } else {
                // เพิ่มใหม่
                items.push({
                    id: Date.now().toString(),
                    name: name,
                    price: parseFloat(price),
                    category: cat,
                    paidHistory: {}
                });
            }

            saveToLocal(); // บันทึกทันที
            closeModal();
            render();
        }

        function deleteItem() {
            const id = document.getElementById('editId').value;
            if(confirm('ต้องการลบรายการนี้ถาวรใช่ไหม?')) {
                items = items.filter(i => i.id != id);
                saveToLocal(); // บันทึกทันที
                closeModal();
                render();
            }
        }

        function openModal(isEdit = false) {
            if(!isEdit) {
                document.getElementById('editId').value = '';
                document.getElementById('nameInput').value = '';
                document.getElementById('priceInput').value = '';
                document.getElementById('catInput').value = 'General';
                document.getElementById('modalTitle').innerText = "เพิ่มรายการใหม่";
                document.getElementById('saveBtn').innerText = "สร้างรายการ";
                document.getElementById('deleteBtn').style.display = "none";
            }
            document.getElementById('modal').classList.add('active');
        }
        
        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        
        function changeMonth(step) {
            currentDate.setMonth(currentDate.getMonth() + step);
            render();
        }
        
        function getIcon(cat) {
            if(cat === 'Entertainment') return '<i class="fas fa-film"></i>';
            if(cat === 'Loan') return '<i class="fas fa-credit-card"></i>';
            if(cat === 'Utility') return '<i class="fas fa-bolt"></i>';
            return '<i class="fas fa-receipt"></i>';
        }

        // เริ่มต้นทำงาน
        loadData();

    </script>
</body>
</html>